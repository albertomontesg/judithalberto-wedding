(function(e,t,n){var i=t.document,o={mode:1};function s(n,s){this.element=n,this.$elem=e(n),this.options=e.extend({},o,s),this._defaults=o,this.oriHeight=0,this.oriWidth=0,this.resizeTimeoutHandle=null,this.isTouchDevice=Modernizr.touch,this.$win=e(t),t.requestAnimationFrame=t.requestAnimationFrame||t.mozRequestAnimationFrame||t.webkitRequestAnimationFrame||t.msRequestAnimationFrame,this.init()}s.prototype.init=function(){this.setupParallax(),requestAnimationFrame!==n&&this.parallaxScrolling()},s.prototype.prefixCSS=function(e,t,n){var s={};s["-webkit-"+t]=n,s["-moz-"+t]=n,s["-ms-"+t]=n,s["-o-"+t]=n,s[t]=n,e.css(s)},s.prototype.setupParallax=function(){var t=this,s=this.$win.height(),o=this.$elem.data("parallax-factor"),n=e("<img />").attr({src:this.$elem.data("background-image"),class:"parallax-bg-img"+(this.options.mode===1?"":" mode-2")}).prependTo(this.element);n.on("load",function(){var n=new Image;n.src=t.$elem.data("background-image"),t.oriHeight=n.height,t.oriWidth=n.width,t.parallaxResize()}),this.$win.on("resize",function(){t.parallaxResize()})},s.prototype.parallaxResize=function(){var t=this.$win.height(),o=this.$elem.data("parallax-factor"),s=this.$elem.innerHeight(),e=this.$elem.find(".parallax-bg-img"),r=this.oriHeight/this.oriWidth,i=this.options.mode===1?t-(t+s)*o:(t+s)*o+s,a=e.height()>i?e.height():i,d=a/r,c=0,l=this.options.mode===1?-a*.5-(t+s)*.5*o:0;this.isTouchDevice||requestAnimationFrame===n?(this.$elem.css({"background-image":'url("'+e.attr("src")+'")',"background-size":"cover"}),e.hide()):e.css({minHeight:i+"px",marginLeft:c+"px",marginTop:l+"px"})},s.prototype.parallaxScrolling=function(){if(a=this,!this.isTouchDevice){var a,n=this.$elem.offset().top,s=this.$win.scrollTop(),o=this.$win.height(),t=s+o-n,i=this.$elem.data("parallax-factor"),e=this.$elem.find(".parallax-bg-img");t<0?this.prefixCSS(e,"transform","translate3d(0, 0, 0)"):this.prefixCSS(e,"transform","translate3d(0, "+(this.options.mode===1?1:-1)*t*i+"px, 0)")}requestAnimationFrame(this.parallaxScrolling.bind(this))},e.fn.parallax=function(t){return this.each(function(){e.data(this,"plugin_parallax")||e.data(this,"plugin_parallax",new s(this,t))})}})(jQuery,window)